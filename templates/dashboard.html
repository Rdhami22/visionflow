{% extends "base.html" %}
{% block title %}Dashboard — VisionFlow{% endblock %}

{% block content %}

<div id="live-clock"></div>
<div id="calendar-box" class="calendar-box"></div>

<h1>Welcome back, {{ user.username }}!</h1>

<div class="dashboard-grid">

    <!-- Points Card -->
    <div class="card">
        <h2>Your Points</h2>
        <p style="font-size: 2rem; color:#ffd9a3;">{{ user.points }} pts</p>

        <div class="progress-bar">
            <div class="progress-fill" style="width: {{ progress }}%;"></div>
        </div>

        <p>{{ 100 - user.points }} points until next reward!</p>
    </div>

    <!-- Tasks -->
    <div class="card">
        <h2>Today's Tasks</h2>

        {% if tasks %}
        {% for task in tasks %}
        <div class="task-item {% if task.completed %}completed{% endif %}">
            <strong>{{ task.title }}</strong><br>
            <small>{{ task.description }}</small>
        </div>
        {% endfor %}
        {% else %}
        <p>No tasks added yet.</p>
        {% endif %}

        <a href="{{ url_for('tasks') }}" class="btn" style="margin-top:1rem;">View All Tasks</a>
    </div>

    <!-- Quick Actions -->
    <div class="card">
        <h2>Quick Actions</h2>
        <a href="/tasks" class="btn" style="display:block; margin-bottom:0.5rem;">Add Task</a>
        <a href="/rewards" class="btn" style="display:block; margin-bottom:0.5rem;">Check Rewards</a>
        <a href="/quiz" class="btn" style="display:block; margin-bottom:0.5rem;">Take a Quiz</a>
        <a href="/jokes" class="btn" style="display:block;">Cheer Me Up</a>
    </div>

</div>

<script>
    function updateClock() {
        const now = new Date();
        document.getElementById("live-clock").textContent =
            now.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit", second: "2-digit" });
    }
    setInterval(updateClock, 1000);
    updateClock();

    document.getElementById("calendar-box").textContent =
        new Date().toLocaleDateString([], { weekday: "long", month: "long", day: "numeric" });
</script>

{% endblock %}
